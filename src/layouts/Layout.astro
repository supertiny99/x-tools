---
import "../styles/global.css";

interface Props {
	title: string;
	description?: string;
}

const { title, description = "在线实用工具集合" } = Astro.props;
---

<!doctype html>
<html lang="zh-CN" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content={description} />
		<title>{title} | X-Tools</title>

		<!-- PWA Meta Tags -->
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#6366f1" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="apple-mobile-web-app-title" content="X-Tools" />
		<link rel="apple-touch-icon" href="/icon-192.png" />

		<!-- Theme initialization -->
		<script is:inline>
			const theme = (() => {
				if (
					typeof localStorage !== "undefined" &&
					localStorage.getItem("theme")
				) {
					return localStorage.getItem("theme");
				}
				if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
					return "dark";
				}
				return "light";
			})();

			if (theme === "dark") {
				document.documentElement.classList.add("dark");
			} else {
				document.documentElement.classList.remove("dark");
			}
			window.localStorage.setItem("theme", theme);
		</script>

		<!-- Google Fonts: Inter -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body
		class="min-h-screen flex flex-col font-sans overflow-x-hidden relative selection:bg-brand-500/30"
	>
		<!-- Base light background -->
		<div
			class="fixed inset-0 bg-slate-50 z-[-20] pointer-events-none transition-colors duration-700"
		>
		</div>

		<!-- Dark mode ripple background -->
		<div
			id="dark-ripple"
			class="fixed inset-0 bg-slate-950 z-[-15] pointer-events-none
			[clip-path:circle(0%_at_calc(100%-5.25rem)_2rem)]
			dark:[clip-path:circle(150%_at_calc(100%-5.25rem)_2rem)]
			transition-all duration-700 ease-in-out"
		>
		</div>
		<!-- Decorative Background Elements -->
		<div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
			<div
				class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-brand-500/10 blur-[120px]"
			>
			</div>
			<div
				class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-indigo-500/10 blur-[120px]"
			>
			</div>
		</div>

		<header
			class="sticky top-0 z-50 w-full border-b border-white/20 dark:border-slate-800/50 bg-white/60 dark:bg-slate-950/60 backdrop-blur-lg"
		>
			<div
				class="container mx-auto px-4 h-16 flex items-center justify-between"
			>
				<a href="/" class="flex items-center gap-2 group">
					<div
						class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-lg shadow-brand-500/30 group-hover:scale-105 transition-transform"
					>
						X
					</div>
					<span
						class="font-bold text-xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300"
					>
						Tools
					</span>
				</a>

				<nav class="flex items-center gap-4">
					<a
						href="/"
						class="text-sm font-medium text-slate-600 hover:text-brand-600 dark:text-slate-300 dark:hover:text-brand-400 transition-colors"
					>
						导航
					</a>
					<a
						href="/tools/webrtc"
						class="text-sm font-medium text-slate-600 hover:text-brand-600 dark:text-slate-300 dark:hover:text-brand-400 transition-colors"
					>
						WebRTC 传连
					</a>

					<!-- PWA Install Button (hidden by default, shown via JS) -->
					<button
						id="pwa-install-btn"
						class="hidden items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-full bg-brand-500/10 hover:bg-brand-500/20 text-brand-600 dark:text-brand-400 border border-brand-500/20 transition-colors cursor-pointer"
						title="安装到桌面"
						aria-label="安装到桌面"
					>
						<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
							<polyline points="7 10 12 15 17 10"></polyline>
							<line x1="12" y1="15" x2="12" y2="3"></line>
						</svg>
						安装
					</button>
	
					<div class="w-px h-5 bg-slate-200 dark:bg-slate-700 mx-2">
					</div>
	
					<!-- Theme Toggle (Pure CSS Water Ripple + JS persist) -->
					<button
						id="theme-toggle"
						class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors cursor-pointer relative z-50 text-slate-600 dark:text-slate-300"
						title="切换主题"
						aria-label="切换主题"
					>
						<!-- Sun Icon (shown in Light mode) -->
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="dark:hidden"
						>
							<circle cx="12" cy="12" r="4"></circle>
							<path d="M12 2v2"></path>
							<path d="M12 20v2"></path>
							<path d="m4.93 4.93 1.41 1.41"></path>
							<path d="m17.66 17.66 1.41 1.41"></path>
							<path d="M2 12h2"></path>
							<path d="M20 12h2"></path>
							<path d="m6.34 17.66-1.41 1.41"></path>
							<path d="m19.07 4.93-1.41 1.41"></path>
						</svg>
						<!-- Moon Icon (shown in Dark mode) -->
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="hidden dark:block"
						>
							<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
						</svg>
					</button>

					<!-- GitHub Link -->
					<a
						href="https://github.com/supertiny99/x-tools"
						target="_blank"
						rel="noopener noreferrer"
						class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-600 dark:text-slate-300"
						aria-label="GitHub Repository"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
						>
							<path
								d="M15 22v-4a4.8 4.8 0 0 0-1-3.02c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A4.8 4.8 0 0 0 8 18v4"
							></path>
							<path d="M12 19l-3-3-3 3"></path>
						</svg>
					</a>
				</nav>
			</div>
		</header>

		<main class="flex-grow flex flex-col">
			<slot />
		</main>

		<footer
			class="py-6 border-t border-slate-200 dark:border-slate-800 text-center text-slate-500 dark:text-slate-400 text-sm mt-auto"
		>
			<p>© {new Date().getFullYear()} X-Tools. 基于 Astro 构建.</p>
		</footer>
		<script>
			const themeToggle = document.getElementById("theme-toggle");

			const handleToggleClick = () => {
				const element = document.documentElement;
				element.classList.toggle("dark");

				const isDark = element.classList.contains("dark");
				localStorage.setItem("theme", isDark ? "dark" : "light");
			};

			themeToggle?.addEventListener("click", handleToggleClick);
		</script>

		<!-- PWA Install Prompt Script -->
		<script>
			let deferredPrompt: Event & { prompt: () => Promise<void>; userChoice: Promise<{ outcome: string }> } | null = null;
			const installBtn = document.getElementById("pwa-install-btn");

			window.addEventListener("beforeinstallprompt", (e) => {
				e.preventDefault();
				deferredPrompt = e as typeof deferredPrompt;
				// Show the install button
				if (installBtn) {
					installBtn.classList.remove("hidden");
					installBtn.classList.add("flex");
				}
			});

			installBtn?.addEventListener("click", async () => {
				if (!deferredPrompt) return;
				deferredPrompt.prompt();
				const { outcome } = await deferredPrompt.userChoice;
				if (outcome === "accepted") {
					deferredPrompt = null;
					if (installBtn) {
						installBtn.classList.add("hidden");
						installBtn.classList.remove("flex");
					}
				}
			});

			window.addEventListener("appinstalled", () => {
				deferredPrompt = null;
				if (installBtn) {
					installBtn.classList.add("hidden");
					installBtn.classList.remove("flex");
				}
			});
		</script>
	</body>
</html>
